---
Title: ' 解放されない リフレクションクラス 3'
Category:
- Tapestry
Date: 2005-11-02T22:52:20+09:00
URL: http://tkatochin.hatenablog.com/entry/20051102/1130939540
EditURL: https://blog.hatena.ne.jp/t-katochin/tkatochin.hatenablog.com/atom/entry/6653586347154756224
---


　WeakHashMapで解決したというのは、見間違い、勘違い、気の迷いでした。JavaDocにある、
>>
実装上の注意: WeakHashMap 内の値オブジェクトは、通常の強参照によって保持されます。このため、値のオブジェクトが直接的にも間接的にも強くそれ自体のキーを参照しないようにしてください。そうすれば、キーが破棄されないようになります。値のオブジェクトが WeakHashMap 自体を介してそのキーを間接的に参照するようにしてください。つまり、値のオブジェクトはほかのキーオブジェクトを必ず参照し、その関連付けられている値のオブジェクトが今度は最初の値のオブジェクトのキーを必ず参照します。この問題については今後のリリースで対処する予定です。 
<<
　…が、該当していたようです。仕方ないのである特定のパターンはキャッシュに登録しないように修正するようにしようかと思います。うーん格好悪い。orz
　圓尾さんが、ReferenceMapというapache.commons.collectionのを紹介してくれたので試してみたが、Ognlのライブラリ自体がなんでもかんでも消えてしまうのはまずい実装になっていたので使えずじまい。残念。でもWeakHashMapの弱点を補っているのでどこかで役立ちそう。
